<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Running Costs :: Glider Labs, Open Source Innovation Lab</title>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png" />
  

  <link href="https://fonts.googleapis.com/css?family=Dosis:400,300,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">

  <link href="/semantic/semantic.min.css" rel="stylesheet" type="text/css">
  <link href="/css/style.css" rel="stylesheet" type="text/css">
  <link href="/css/header.css" rel="stylesheet" type="text/css">
  <link href="/css/footer.css" rel="stylesheet" type="text/css">
  <link href="/css/article.css" rel="stylesheet" type="text/css">
</head>
<body>
<header>
  <div class="ui container">
    <div class="ui text menu">
      <div class="item brand">
        <a href="/"><img src="/images/logo.svg" /></a>
      </div>
      
      <div class="right item">
        <a href="/devlog/">Devlog</a>
      </div>
      
      <div class="item">
        <a href="/wiki/">Wiki</a>
      </div>
      
      <div class="item">
        <a href="http://gliderlabs.com/projects">Projects</a>
      </div>
      
      <div class="item">
        <a href="/services/">Services</a>
      </div>
      
      <div class="item">
        <a href="http://glider-slackin.herokuapp.com">Community</a>
      </div>
      
      <div class="item">
        <a href="/finances/">Finances</a>
      </div>
      
    </div>
  </div>
</header>

<main>

<div class="ui container">
  <div class="ui grid">
    <div class="one wide column"></div>
    <div class="twelve wide column">
      <article>
        <h1 class="ui header">Running Costs</h1>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.17.2/lodash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script type="text/javascript" src="https://rawgit.com/chartjs/chartjs-plugin-annotation/master/chartjs-plugin-annotation.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
var rawdata = {};
var data = {};
var info = {};
var chart = null;
var colors = ["#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f","#56beac","#8f88bf","#f93d28","#478ebf","#fc9016","#92cd2d","#f885bf","#b3b3b3","#9d529e","#9ad78c","#ffe322","#379080","#6158a3","#ce1a06","#30658a","#c36902","#668f1f","#f33d9a","#8c8c8c","#6b386c","#68c453","#d5ba00"];

function sum(n) {
  return _.reduce(n, function(sum,m) { return sum+m });
}

function init() {
  $.ajax("https://tully-gl.herokuapp.com/balance", {
  	error: function(xhr, status, err) {
  		console.log(err);
  		alert(status);
  	},
    success: function(rawdata) {
      _.forEach(_.groupBy(rawdata, "account"), function(value, key) {
        var values = _.map(value, "amount");
        var total = sum(values);
        var months = _.reduce(values, function(mo,n) {
          if (n > 0)
            return mo+1;
          else
            return mo;
        }, 0);
        var active = (sum(_.slice(values, -3)) != 0 || months == 1)
        var monthly = (months < 2 || !active) ? null : Math.round(total/months * 100) / 100;
        info[key] = {
          values: values,
          total: total,
          active: active,
          monthly: monthly
        };
        if (_.includes(key, "Hosted Services")) {
          info[key].type = "service";
        } else if (_.includes(key, "Contractors") || _.includes(key, "Equity:Draw")) {
          info[key].type = "staff";
        } else if (!_.includes(key, "Assets:")){
          info[key].type = "other";
        }
      });
      update("service");
    }
  });
}

function update(mode) {
  data = {};
  _.forEach(info, function(account, key) {
    if (account.total > 0 && account.type == mode) {
      data[key] = account.values;
    }
  });
  drawTable();
  drawChart();
}

function tableName(name) {
  var parts = name.split(":");
  parts.shift();
  return parts.join(":")
}

function chartName(name) {
  var parts = name.split(":");
  return parts[parts.length-1];
}

function drawChart() {
  var ctx = document.getElementById("myChart");
  if (chart !== null) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ["Jan '16", "Feb '16", "Mar '16", "Apr '16", "May '16", "Jun '16", "Jul '16", "Aug '16", "Sep '16", "Oct '16", "Nov '16", "Dec '16"],
      datasets: _.map(_.keys(data), function(key, idx) {
      	return {
          label: chartName(key),
          data: data[key],
          backgroundColor: colors[idx],
          pointHoverBackgroundColor: colors[idx],
          pointBackgroundColor: "rgba(0,0,0,0)",
          borderColor: "rgba(0,0,0,0)"
      	}
      })
    },
    options: {
      legend: {
        position: "bottom",
        display: false
      },
      scales: {
        xAxes: [
         {gridLines: {
          	display: false
          }}
        ],
        yAxes: [{
          stacked: true,
          ticks: {
            beginAtZero: true,
            callback: function(value) {return "$"+value.toString();}
          }
        }]
      },
      tooltips: {
      	enabled: true,
        intersect: false,
        mode: 'index',
        displayColors: false,
        filter: function(v, o) {
          if (o.datasets[v.datasetIndex].data[v.index] == 0) return null;
          return v;
        }
      }
    }/*,
      annotation: {
  	    drawTime: 'beforeDatasetsDraw',
          annotations: [{
              id: 'a-line-1', // optional
              type: 'line',
              mode: 'vertical',
              scaleID: 'y-axis-0',
              value: '4',
              borderColor: "#00f",
              borderWidth: 2,
              label: {
                content: "Reboot",
                enabled: true,
                fontColor: "#000",
                yAdjust: -10,
                xAdjust: 24,
                fontStyle: "normal",
                backgroundColor: "rgba(0,0,0,0)"
              }
          }]
      }
    }*/
  });
}

google.charts.load('current', {'packages':['table']});
google.charts.setOnLoadCallback(init);

function drawTable() {
  var datatable = new google.visualization.DataTable();
  var formatter = new google.visualization.NumberFormat({prefix: '$'});

  datatable.addColumn('string', '');
  datatable.addColumn('string', 'Account');
  datatable.addColumn('number', 'Monthly');
  datatable.addColumn('number', 'YTD');
  datatable.addRows(_.map(_.keys(data), function(key, idx) {
    var style = (info[key].active || info[key].type != "service") ? "" : "text-decoration: line-through;";
    return [
      {v:'', p:{style:"background: "+colors[idx]+";"}},
      {v: tableName(key), p:{style:style}},
      {v: info[key].monthly, p:{style:"width: 150px;"}},
      {v: info[key].total, p:{style:"width: 150px;"}}]
  }));
  formatter.format(datatable, 3);
  formatter.format(datatable, 2);
  var table = new google.visualization.Table(document.getElementById('table_div'));

  table.draw(datatable, {
    allowHtml: true,
    showRowNumber: false,
    width: '100%',
    height: '100%', 'cssClassNames': {'headerCell': 'finance-table-header'}});
}

function select(type, el) {
  $("#modes .button").removeClass("active");
  $(el).addClass("active");
  update(type);
}
</script>

<div id="modes" class="ui right floated basic buttons" style="margin-top: -55px;">
  <div class="ui button active" onclick="select('service', this)">Services</div>
  <div class="ui button" onclick="select('staff', this)">Staff</div>
  <div class="ui button" onclick="select('other', this)">Other</div>
</div>

<p>
Here we share our expenses and running costs to operate Glider Labs and develop our projects.
This data is straight from our books and updated in realtime.
</p>

<p>
  <div style="width: 1000px; position: relative; margin-left: -120px;">
    <canvas id="myChart" width="30" height="10"></canvas>
  </div>
</p>

<p><div id="table_div"></div></p>

<p>
  <small>Monthly is averaged over months with transactions.
    No monthly means inactive, annual, or a one-time expense.</small>
</p>

      </article>
    </div>
  </div>
</div>

</main>
<footer>
  <div class="ui container grid">
    <div class="row text-left">
      <div class="three wide column first">
        <h4><img src="/images/dots-bw.svg" /> Glider Labs</h4>
        <div class="ui list">
          
          <div class="item"><a href="/devlog/">Devlog</a></div>
          
          <div class="item"><a href="/wiki/">Wiki</a></div>
          
          <div class="item"><a href="http://gliderlabs.com/projects">Projects</a></div>
          
          <div class="item"><a href="/services/">Services</a></div>
          
          <div class="item"><a href="http://glider-slackin.herokuapp.com">Community</a></div>
          
          <div class="item"><a href="/finances/">Finances</a></div>
          
        </div>
      </div>
      <div class="three wide column">
        <h4>Connect</h4>
        <div class="ui list">
          <div class="item"><a href="http://glider-slackin.herokuapp.com">Slack</a></div>
          <div class="item"><a href="http://twitter.com/gliderlabs">Twitter</div>
          <div class="item"><a href="https://kiwiirc.com/client/irc.freenode.net/#gliderlabs">IRC</a></div>
          <div class="item"><a href="https://github.com/gliderlabs">GitHub</a></div>
          <div class="item"><a href="https://vimeo.com/gliderlabs">Vimeo</a></div>
        </div>
      </div>
      <div class="five wide column">
        <h4>Projects</h4>
        <div class="ui list">
          <div class="item"><a href="https://github.com/dokku/dokku">Dokku</a></div>
          <div class="item"><a href="https://github.com/gliderlabs/docker-alpine">Alpine for Docker</a></div>
          <div class="item"><a href="https://github.com/gliderlabs/registrator">Registrator</a></div>
          <div class="item"><a href="https://github.com/gliderlabs/logspout">Logspout</a></div>

          <div class="item"><a href="https://gliderlabs.com/projects">More...</a></div>
        </div>
      </div>
      <div class="five wide column">
        <h4>Subscribe for Updates</h4>
        <form action="//gliderlabs.us10.list-manage.com/subscribe/post?u=49c4b06ffd30bcf49ec53c277&amp;id=616ca7efc0"
          method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" target="_blank" novalidate>
          <div class="ui small right action input">
              <input type="email" value="" name="EMAIL" class="email input" id="mce-EMAIL" placeholder="Email Address" required>
              
              <input type="submit" value="SUBSCRIBE" name="subscribe" id="mc-embedded-subscribe" class="ui button">
              <div style="position: absolute; left: -5000px;"><input type="text" name="b_49c4b06ffd30bcf49ec53c277_616ca7efc0" tabindex="-1" value=""></div>
          </div>
        </form>
        <small>Stay informed and get our devlog in your inbox.</small>
      </div>
    </div>
    <div class="row text-left">
      <div class="twelve wide column">
        <br />
        <small>Copyright &copy; Glider Labs 2017<br />
          Made in Austin, Texas.</small>
      </div>
    </div>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-58928488-1', 'auto');
ga('send', 'pageview');
</script>

<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/semantic/semantic.min.js"></script>
<script type="text/javascript">$('.ui.embed').embed();</script>
</body>
</html>
